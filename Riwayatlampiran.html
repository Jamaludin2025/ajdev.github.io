<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Riwayat Pernikahan</title>
  <style>
    /* (CSS tetap seperti sebelumnya, tidak diubah) */
    body {
      font-family: Arial, sans-serif;
      margin: 10px;
      background: #f2f2f2;
    }
    .riwayat-bar {
      background: #fff;
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .btn {
      padding: 5px 10px;
      margin: 5px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .detail {
      display: none;
      margin-top: 10px;
    }
    .detail.show {
      display: block;
    }
    #modalEdit {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    #formEdit {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 400px;
      width: 90%;
    }
  </style>
</head>
<body>

<div id="riwayatList"></div>

<!-- Modal Edit -->
<div id="modalEdit">
  <form id="formEdit">
    <h3>Edit Data</h3>
    <input type="hidden" id="editKode" />
    <label>Tanggal: <input type="date" id="editTanggal" required></label><br>
    <label>Kerabat: <input type="text" id="editKerabat" required></label><br>
    <label>Pasangan: <input type="text" id="editPasangan" required></label><br>
    <label>Nama Ayah: <input type="text" id="editBapak"></label><br>
    <label>Nama Ibu: <input type="text" id="editIbu"></label><br>
    <label>Kampung: <input type="text" id="editKampung"></label><br>
    <label>RT: <input type="text" id="editRT"></label><br>
    <label>RW: <input type="text" id="editRW"></label><br>
    <label>Kabupaten:
      <select id="editKabupaten" onchange="isiDropdownKecamatan()"></select>
    </label><br>
    <label>Kecamatan:
      <select id="editKecamatan" onchange="isiDropdownDesa()"></select>
    </label><br>
    <label>Desa:
      <select id="editDesa"></select>
    </label><br>
    <label>Bingkisan:
      <select id="editBingkisan" onchange="toggleBingkisanEdit()">
        <option value="Uang">Uang</option>
        <option value="Kado">Kado</option>
      </select>
    </label><br>
    <div id="editUangGroup">
      <label>Nominal Uang: <input type="number" id="editNominal"></label><br>
    </div>
    <div id="editKadoGroup" style="display:none;">
      <label>Nama Barang: <input type="text" id="editNamaBarang"></label><br>
      <label>Nominal Barang: <input type="number" id="editNominalBarang"></label><br>
    </div>
    <button type="submit" class="btn">Simpan</button>
    <button type="button" class="btn" onclick="closeModal()">Batal</button>
  </form>
</div>

<script>
  // Ambil data dari localStorage
  const data = JSON.parse(localStorage.getItem("dataPernikahan")) || [];

  const riwayatList = document.getElementById("riwayatList");

  data.forEach((item, index) => {
    const div = document.createElement("div");
    div.className = "riwayat-bar";
    div.innerHTML = `
      <strong>${item.kerabat}</strong> - ${item.pasangan} (${item.tanggal})<br>
      <button class="btn" onclick="toggleDetail(${index})">Lihat Selengkapnya</button>
      <button class="btn" onclick="editData('${item.kode}')">Edit</button>
      <button class="btn" onclick="hapusData('${item.kode}')">Hapus</button>
      <div class="detail" id="detail-${index}">
        <p>Nama Ayah: ${item.bapak || '-'}</p>
        <p>Nama Ibu: ${item.ibu || '-'}</p>
        <p>Alamat: ${item.kampung || '-'}, RT ${item.rt || '-'} / RW ${item.rw || '-'}, ${item.desa || '-'}, ${item.kecamatan || '-'}, ${item.kabupaten || '-'}</p>
        <p>Bingkisan: ${item.bingkisan}</p>
        ${item.bingkisan === "Kado"
          ? `<p>Nama Barang: ${item.namaBarang || '-'}</p><p>Nominal Barang: Rp${item.nominal || '0'}</p>`
          : `<p>Nominal Uang: Rp${item.nominal || '0'}</p>`
        }
      </div>
    `;
    riwayatList.appendChild(div);
  });

  function toggleDetail(index) {
    const detail = document.getElementById("detail-" + index);
    detail.classList.toggle("show");
  }

  function hapusData(kode) {
    if (confirm("Yakin ingin menghapus data ini?")) {
      let data = JSON.parse(localStorage.getItem("dataPernikahan")) || [];
      data = data.filter(d => d.kode !== kode);
      localStorage.setItem("dataPernikahan", JSON.stringify(data));
      location.reload();
    }
  }
</script>

  <script>
    // Tampilkan data dari localStorage
    const riwayatList = document.getElementById("riwayatList");
    const data = JSON.parse(localStorage.getItem("dataPernikahan")) || [];

    data.forEach((item, index) => {
      const div = document.createElement("div");
      div.className = "riwayat-bar";

      div.innerHTML = `
        <div class="info">
          <h3>${item.kerabat}</h3>
          <p>${item.pasangan}</p>
          <p>${item.tanggal}</p>
        </div>
        <div class="actions">
          <button onclick="toggleDetail(${index})">Lihat Selengkapnya</button>
          <button onclick="editData('${item.kode}')">Edit</button>
          <button onclick="hapusData('${item.kode}')">Hapus</button>
        </div>
        <div class="detail" id="detail-${index}">
          <p><span>Nama Ayah</span><span>: ${item.bapak}</span></p>
          <p><span>Nama Ibu</span><span>: ${item.ibu}</span></p>
          <p><span>Alamat</span><span>: ${item.kampung}, RT ${item.rt}/RW ${item.rw}, ${item.desa}, ${item.kecamatan}, ${item.kabupaten}</span></p>
          <p><span>Bingkisan</span><span>: ${item.bingkisan}</span></p>
          ${
            item.bingkisan === "Uang"
              ? `<p><span>Nominal Uang</span><span>: Rp ${item.nominal}</span></p>`
              : `<p><span>Nama Barang</span><span>: ${item.namaBarang}</span></p>
                 <p><span>Nominal Barang</span><span>: Rp ${item.nominal}</span></p>`
          }
        </div>
      `;

      riwayatList.appendChild(div);
    });

    function toggleDetail(index) {
      const detail = document.getElementById("detail-" + index);
      detail.classList.toggle("show");
    }
    function hapusData(kode) {
      if (confirm("Yakin ingin menghapus data ini?")) {
        let data = JSON.parse(localStorage.getItem("dataPernikahan")) || [];
        data = data.filter(d => d.kode !== kode);
        localStorage.setItem("dataPernikahan", JSON.stringify(data));
        location.reload();
      }
    }

    function editData(kode) {
      const data = JSON.parse(localStorage.getItem("dataPernikahan")) || [];
      const item = data.find(d => d.kode === kode);
      if (!item) return;

      document.getElementById("editKode").value = item.kode;
      document.getElementById("editTanggal").value = item.tanggal;
      document.getElementById("editKerabat").value = item.kerabat;
      document.getElementById("editPasangan").value = item.pasangan;
      document.getElementById("editBapak").value = item.bapak;
      document.getElementById("editIbu").value = item.ibu;
      document.getElementById("editKampung").value = item.kampung;
      document.getElementById("editRT").value = item.rt;
      document.getElementById("editRW").value = item.rw;

      isiDropdownKabupaten();
      document.getElementById("editKabupaten").value = item.kabupaten;
      isiDropdownKecamatan();
      document.getElementById("editKecamatan").value = item.kecamatan;
      isiDropdownDesa();
      document.getElementById("editDesa").value = item.desa;

      document.getElementById("editBingkisan").value = item.bingkisan;

      if (item.bingkisan === "Kado") {
        document.getElementById("editNamaBarang").value = item.namaBarang || '';
        document.getElementById("editNominalBarang").value = item.nominal || '';
        toggleBingkisanEdit();
      } else {
        document.getElementById("editNominal").value = item.nominal || '';
        toggleBingkisanEdit();
      }

      document.getElementById("modalEdit").style.display = "flex";
    }

    function closeModal() {
      document.getElementById("modalEdit").style.display = "none";
    }
  document.addEventListener("DOMContentLoaded", () => {
    isiDropdownKabupaten();

    // Update dropdown berantai saat user ubah pilihan
    document.getElementById("editKabupaten").addEventListener("change", () => {
      isiDropdownKecamatan();
      isiDropdownDesa();
    });

    document.getElementById("editKecamatan").addEventListener("change", () => {
      isiDropdownDesa();
    });

    // Tampilkan kolom sesuai pilihan Bingkisan
    document.getElementById("editBingkisan").addEventListener("change", () => {
      toggleBingkisanEdit();
    });
  });
</script>
</body>
</html>
